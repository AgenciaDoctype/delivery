<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Central de Pedidos - VaptVupt Delivery</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="icon" href="https://i.ibb.co/ccnPx5ym/Chat-GPT-Image-3-de-jun-de-2025-12-21-02-Photoroom.png" type="image/x-icon">
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js">
    function updateLateOrdersDashboard() {
      const now = new Date();
      const lateThreshold = 5 * 1000;
      const lateOrdersBody = document.getElementById('late-orders-body');

      const lateOrders = allOrders.filter(order => {
        const orderTime = new Date(order.data);
        const timeDiff = now - orderTime;
        return (
          (order.status === 'Aguardando confirma√ß√£o' ||
           order.status.includes('iniciando')) &&
          timeDiff > lateThreshold
        );
      });

      lateOrdersBody.innerHTML = '';

      if (lateOrders.length === 0) {
        lateOrdersBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">
              Nenhum pedido em atraso no momento
            </td>
          </tr>
        `;
        return;
      }

      lateOrders.sort((a, b) => new Date(a.data) - new Date(b.data));

      lateOrders.forEach(order => {
        const orderTime = new Date(order.data);
        const timeDiff = now - orderTime;
        const minutesLate = Math.floor(timeDiff / (60 * 1000));

        let statusText = 'Aguardando Aceite';
        let statusClass = 'status-pending';
        let actionButton = '';

        if (order.status.includes('iniciando')) {
          statusText = 'Preparando pedido';
          statusClass = 'status-preparing';
          actionButton = `
            <button class="btn btn-sm btn-warning" onclick="confirmarEnviarEntrega('${order.id}')">
              Enviar para Entrega
            </button>
          `;
        } else {
          actionButton = `
            <button class="btn btn-sucess btn-sm" onclick="confirmarAceitarPedido('${order.id}')">
              Aceitar Pedido
            </button>
          `;
        }

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${order.id.substring(0, 8)}</td>
          <td>${order.cliente.nome}</td>
          <td>${minutesLate} minutos de atraso</td>
          <td class="${statusClass}">${statusText}</td>
          <td>${actionButton}</td>
        `;

        lateOrdersBody.appendChild(row);
      });
    }


    function confirmarAceitarPedido(pedidoId) {
      currentOrderId = pedidoId;
      updateOrderStatus(pedidoId, 'preparing');
    }

    function confirmarEnviarEntrega(pedidoId) {
      currentOrderId = pedidoId;
      updateOrderStatus(pedidoId, 'delivery');
    }

</script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #FF6B00;
      --primary-dark: #E65100;
      --secondary: #4A2F0B;
      --light: #FFF8EF;
      --white: #FFFFFF;
      --success: #4CAF50;
      --warning: #FFC107;
      --danger: #F44336;
      --gray: #F5F5F5;
      --dark-gray: #757575;
      --sidebar-width: 250px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      line-height: 1.6;
      background-image: url('https://images.unsplash.com/photo-1600891964599-f61ba0e24092?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      z-index: -1;
    }
    
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .login-card {
      background: rgba(30, 30, 30, 0.95);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      padding: 40px;
      width: 100%;
      max-width: 450px;
      text-align: center;
      border: 1px solid rgba(255, 107, 0, 0.3);
      backdrop-filter: blur(10px);
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .login-card h2 {
      margin-bottom: 20px;
      color: var(--primary);
      font-size: 28px;
      font-weight: 600;
    }
    
    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #e0e0e0;
    }
    
    .input-group input {
      width: 100%;
      padding: 14px 20px;
      border: 2px solid rgba(255, 107, 0, 0.3);
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
      background-color: rgba(45, 45, 45, 0.8);
      color: #ffffff;
    }
    
    .input-group input:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 107, 0, 0.2);
    }
    
    .btn {
      display: inline-block;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    
    .btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(230, 81, 0, 0.3);
    }
    
    .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(230, 81, 0, 0.3);
    }
    
    .btn-block {
      display: block;
      width: 100%;
    }
    
    .error-message {
      color: var(--danger);
      margin-top: 10px;
      display: none;
      font-weight: 500;
    }
    
    .burger-icon {
      font-size: 40px;
      color: var(--primary);
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .dashboard {
      display: none;
      margin-left: var(--sidebar-width);
      transition: margin-left 0.3s;
    }
    
    .dashboard.full-width {
      margin-left: 0;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 30px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo h1 {
      font-size: 24px;
      color: var(--primary);
      margin: 0;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-width);
      height: 100%;
      background: rgba(30, 30, 30, 0.95);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(255, 107, 0, 0.2);
      padding: 20px 0;
      z-index: 100;
      transition: transform 0.3s;
      overflow-y: auto;
    }
    
    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    
    .sidebar-menu {
      list-style: none;
      padding: 0;
    }
    
    .sidebar-menu li {
      margin-bottom: 5px;
    }
    
    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: #e0e0e0;
      text-decoration: none;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .sidebar-menu a:hover, .sidebar-menu a.active {
      background-color: rgba(255, 107, 0, 0.1);
      color: var(--primary);
      border-left: 3px solid var(--primary);
    }
    
    .sidebar-menu i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }
    
    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(30, 30, 30, 0.95);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(255, 107, 0, 0.2);
      padding: 10px 0;
      z-index: 100;
    }
    
    .mobile-nav-menu {
      display: flex;
      justify-content: space-around;
      list-style: none;
    }
    
    .mobile-nav-menu a {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: #e0e0e0;
      text-decoration: none;
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .mobile-nav-menu a:hover, .mobile-nav-menu a.active {
      color: var(--primary);
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .mobile-nav-menu i {
      font-size: 20px;
      margin-bottom: 5px;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: rgba(30, 30, 30, 0.8);
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 20px;
      transition: transform 0.3s, box-shadow 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    
    .stat-icon.pending {
      background-color: rgba(255, 193, 7, 0.2);
      color: var(--warning);
    }
    
    .stat-icon.preparing {
      background-color: rgba(255, 107, 0, 0.2);
      color: var(--primary);
    }
    
    .stat-icon.delivery {
      background-color: rgba(33, 150, 243, 0.2);
      color: #2196F3;
    }
    
    .stat-icon.completed {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--success);
    }
    
    .stat-info h3 {
      font-size: 14px;
      color: var(--dark-gray);
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .stat-info p {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
    }
    
    .charts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: rgba(30, 30, 30, 0.8);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .chart-card h3 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 18px;
      color: var(--primary);
    }
    
    .chart-container {
      position: relative;
      height: 250px;
      width: 100%;
    }
    
    .orders-container {
      background: rgba(30, 30, 30, 0.8);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .orders-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .orders-header h2 {
      font-size: 20px;
      margin: 0;
      color: var(--primary);
    }
    
    .tabs {
      display: flex;
      gap: 10px;
    }
    
    .tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .tab.active {
      background-color: var(--primary);
      color: white;
    }
    
    .tab:not(.active):hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .order-list {
      padding: 0;
      margin: 0;
      list-style: none;
    }
    
    .order-item {
      padding: 25px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s;
      background: rgba(40, 40, 40, 0.5);
      margin: 15px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    .order-item:hover {
      background-color: rgba(255, 107, 0, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .order-id {
      font-weight: 700;
      color: var(--primary);
      font-size: 18px;
    }
    
    .order-time {
      font-size: 14px;
      color: var(--dark-gray);
    }
    
    .order-status {
      display: inline-block;
      padding: 6px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin: 10px 0;
    }
    
    .status-pending {
      background-color: rgba(255, 193, 7, 0.2);
      color: var(--warning);
    }
    
    .status-preparing {
      background-color: rgba(255, 107, 0, 0.2);
      color: var(--primary);
    }
    
    .status-delivery {
      background-color: rgba(33, 150, 243, 0.2);
      color: #2196F3;
    }
    
    .status-completed {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--success);
    }
    
    .order-customer {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .customer-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .customer-info h4 {
      font-size: 18px;
      margin: 0 0 5px 0;
      font-weight: 600;
    }
    
    .customer-info p {
      font-size: 14px;
      color: var(--dark-gray);
      margin: 0;
    }
    
    .order-details {
      margin-top: 15px;
    }
    
    .order-items {
      list-style: none;
      margin: 0 0 15px 0;
      padding: 0;
    }
    
    .order-item-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
    }
    
    .order-item-row:last-child {
      border-bottom: none;
    }
    
    .order-total {
      display: flex;
      justify-content: space-between;
      font-weight: 700;
      padding-top: 15px;
      border-top: 1px dashed rgba(255, 255, 255, 0.2);
      font-size: 18px;
    }
    
    .order-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .btn-sm {
      padding: 10px 18px;
      font-size: 14px;
      border-radius: 12px;
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .btn-success {
      background-color: var(--success);
    }
    
    .btn-success:hover {
      background-color: #3d8b40;
    }
    
    .btn-warning {
      background-color: var(--warning);
      color: #333;
    }
    
    .btn-warning:hover {
      background-color: #e6ac00;
    }
    
    .btn-info {
      background-color: #2196F3;
    }
    
    .btn-info:hover {
      background-color: #0b7dda;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    
    .empty-state i {
      font-size: 60px;
      color: var(--dark-gray);
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    .empty-state p {
      color: var(--dark-gray);
      margin-bottom: 20px;
      font-size: 16px;
    }
    
    .time-indicator {
      font-size: 13px;
      color: var(--dark-gray);
      margin-top: 5px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .time-indicator i {
      font-size: 12px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      overflow: auto;
    }

    .modal-content {
      background: rgba(30, 30, 30, 0.95);
      margin: 5% auto;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 107, 0, 0.3);
      width: 90%;
      max-width: 500px;
      animation: fadeIn 0.3s;
      position: relative;
    }
    
    .modal-content.large {
      max-width: 800px;
    }

    .close-modal {
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
    }

    .close-modal:hover {
      color: var(--primary);
    }

    .relatorio-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #444;
    }
    
    .relatorio-header h2 {
      color: var(--primary);
      margin-bottom: 10px;
    }

    .relatorio-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .relatorio-table th {
      background-color: var(--primary);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    .relatorio-table td {
      padding: 12px;
      border-bottom: 1px solid #444;
    }

    .relatorio-table tr:nth-child(even) {
      background-color: rgba(45, 45, 45, 0.5);
    }

    .relatorio-table tr:hover {
      background-color: rgba(255, 107, 0, 0.1);
    }
    
    .export-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .export-buttons .btn {
      flex: 1;
    }
    
    .filter-group {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .filter-group .input-group {
      flex: 1;
      margin-bottom: 0;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: var(--primary);
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      transform: translateX(150%);
      transition: transform 0.3s;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast i {
      font-size: 20px;
    }

    .print-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      overflow: auto;
    }

    .print-content {
      background: white;
      margin: 2% auto;
      padding: 20px;
      width: 80%;
      max-width: 600px;
      color: black;
      font-family: Arial, sans-serif;
    }

    .print-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }

    .print-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
    }

    .print-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .late-orders-dashboard {
      background: rgba(30, 30, 30, 0.8);
      border-radius: 16px;
      padding: 20px;
      margin: 15px;
      border: 1px solid rgba(255, 107, 0, 0.3);
    }

    .late-orders-dashboard h3 {
      color: var(--primary);
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .late-orders-table-container {
      overflow-x: auto;
    }

    .late-orders-table {
      width: 100%;
      border-collapse: collapse;
    }

    .late-orders-table th {
      background-color: var(--primary);
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 500;
    }

    .late-orders-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .late-orders-table tr:nth-child(even) {
      background-color: rgba(45, 45, 45, 0.5);
    }

    .late-orders-table tr:hover {
      background-color: rgba(255, 107, 0, 0.1);
    }

    .late-orders-table .status-pending {
      color: var(--warning);
    }

    .late-orders-table .status-preparing {
      color: var(--primary);
    }

    .late-orders-table .action-btn {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .late-orders-table .action-btn.accept {
      background-color: var(--success);
      color: white;
    }

    .late-orders-table .action-btn.send {
      background-color: var(--warning);
      color: #333;
    }

    @media print {
      body * {
        visibility: hidden;
      }
      #relatorioModal, #relatorioModal *,
      .print-modal, .print-modal * {
        visibility: visible;
      }
      #relatorioModal, .print-modal {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        background: white;
      }
      .modal-content, .print-content {
        box-shadow: none;
        border: none;
        width: 100%;
        max-width: 100%;
      }
      .close-modal, button {
        display: none !important;
      }
      .relatorio-table {
        page-break-inside: auto;
      }
      .relatorio-table tr {
        page-break-inside: avoid;
        page-break-after: auto;
      }
    }
    
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .dashboard {
        margin-left: 0;
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .mobile-nav {
        display: block;
      }
      
      .charts-container {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 15px;
      }
      
      .stats-container {
        grid-template-columns: 1fr 1fr;
      }
      
      .tabs {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .order-actions {
        justify-content: center;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
      
      .filter-group {
        flex-direction: column;
      }
    }
    
    @media (max-width: 576px) {
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .order-item {
        padding: 20px;
        margin: 10px;
      }
      
      .order-actions .btn {
        flex: 1 0 100%;
      }
    }
  </style>

<style>
@media print {
  body * {
    visibility: hidden !important;
  }

  .print-modal, .print-modal * {
    visibility: visible !important;
  }

  .print-modal {
    position: fixed !important;
    left: 0;
    top: 0;
    width: 72mm !important;
    min-height: 100%;
    background: white;
    margin: 0;
    padding: 5mm;
    box-shadow: none;
    border: none;
    z-index: 9999;
    color: black;
    font-family: 'Courier New', monospace;
    font-size: 12px;
  }

  .print-content {
    width: 100%;
  }

  .print-header {
    text-align: center;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dashed #000;
  }

  .print-header h1 {
    font-size: 16px;
    margin: 0 0 5px 0;
  }

  .print-header p {
    margin: 0;
    font-size: 12px;
  }

  hr {
    border: none;
    border-top: 1px dashed #000;
    margin: 5px 0;
  }

  p {
    margin: 3px 0;
    line-height: 1.2;
  }

  strong {
    font-weight: bold;
  }

  .print-buttons,
  .close-modal,
  button,
  nav,
  header,
  .sidebar,
  .mobile-nav,
  .dashboard,
  .container {
    display: none !important;
  }
}
</style>

</head>
<body>
  <div class="overlay"></div>


  <!--LOGO COM ESCRITA LOGO ABAIXO, INDICANDO QUAL O PAINEL QUE O CLIENTE ESTA-->
  <div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo" style="text-align: center; display: flex; flex-direction: column; align-items: center;">
      <img src="https://i.ibb.co/ccnPx5ym/Chat-GPT-Image-3-de-jun-de-2025-12-21-02-Photoroom.png" 
           alt="VaptVupt Deliver Logo" 
           style="max-width: 200px; height: auto;">
      <div style="color: #FF6B00; margin-top: 8px; font-size: 18px; font-weight: 600;"> Central de Pedidos          
      </div>
    </div>
  </div>
<!--FIM DA LOGO -->
    
    <ul class="sidebar-menu">
      <li><a href="#" class="active"><i class="fas fa-box"></i> Pedidos</a></li>
      
<ul class="sidebar-submenu" style="padding-left: 20px;">
</ul>
</li>
      
    </ul>
  </div>
  
  <div class="mobile-nav">
    <ul class="mobile-nav-menu">
      <li><a href="#" class="active"><i class="fas fa-box"></i><span>Pedidos</span></a></li>
      <li><a href="#" onclick="abrirRelatorioLogin()"><i class="fas fa-chart-line"></i><span>Relat√≥rios</span></a></li>
      <li><a href="#"><i class="fas fa-cog"></i><span>Config</span></a></li>
      <li><a href="#"><i class="fas fa-user"></i><span>Perfil</span></a></li>
    </ul>
  </div>
  
  <div class="toast" id="toastNotification">
    <i class="fas fa-bell"></i>
    <span>üö® Novo pedido recebido!</span>
  </div>
  
  <div class="container login-container" id="loginForm" style="display: flex;">
  <div class="login-card">
    <h2>Login Admin</h2>
    <form onsubmit="event.preventDefault(); realizarLogin();">
      <div class="input-group">
        <label for="emailInput">E-mail</label>
        <input type="email" id="emailInput" required />
      </div>
      <div class="input-group">
        <label for="senhaInput">Senha</label>
        <input type="password" id="senhaInput" required />
      </div>
      <button type="submit" class="btn btn-block">Entrar</button>
      <p class="error-message" id="mensagemErro">Credenciais inv√°lidas!</p>
    </form>
  </div>
</div>

  <div class="container dashboard" id="painelPedidos">
    <div class="header">
      <div style="display: flex; align-items: center; gap: 15px;">
        <button class="btn btn-sm" id="toggleSidebar" onclick="toggleSidebar()" style="display: none;">
          <i class="fas fa-bars"></i>
        </button>
        <div class="logo">
          <i class="fas fa-utensils"></i>
          <h1>Boteco do Cassim</h1>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 15px;">
        
<button class="btn btn-outline" onclick="logout()">
  <i class="fas fa-sign-out-alt"></i> Sair
</button>

      </div>
    </div>

    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon pending">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-info">
          <h3>Pedidos Pendentes</h3>
          <p id="stat-pending">0</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon preparing">
          <i class="fas fa-utensils"></i>
        </div>
        <div class="stat-info">
          <h3>Em Preparo</h3>
          <p id="stat-preparing">0</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon delivery">
          <i class="fas fa-motorcycle"></i>
        </div>
        <div class="stat-info">
          <h3>Saiu para Entrega</h3>
          <p id="stat-delivery">0</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon completed">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
          <h3>Conclu√≠dos</h3>
          <p id="stat-completed">0</p>
        </div>
      </div>
    </div>
    
    <div class="charts-container">
            <div class="chart-card">
        <h3>Pedidos por Status</h3>
        <div class="chart-container">
          <canvas id="statusChart"></canvas>
        </div>
      </div>
    </div>

    <div class="orders-container">
      <div class="orders-header">
        <h2>Pedidos Recentes</h2>
        <div class="tabs">
          <div class="tab active" onclick="filterOrders('all')">Todos</div>
          <div class="tab" onclick="filterOrders('pending')">Pendentes</div>
          <div class="tab" onclick="filterOrders('preparing')">Preparando</div>
          <div class="tab" onclick="filterOrders('delivery')">Entrega</div>
          <div class="tab" onclick="filterOrders('completed')">Conclu√≠dos</div>
        </div>
      </div>
      
      <div class="late-orders-dashboard">
        <h3>Pedidos em Atraso</h3>
        <div class="late-orders-table-container">
          <table class="late-orders-table">
            <thead>
              <tr>
                <th>ID Pedido</th>
                <th>Nome do Cliente</th>
                <th>Tempo de Atraso</th>
                <th>Status</th>
                <th>A√ß√£o</th>
              </tr>
            </thead>
            <tbody id="late-orders-body">
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px;">
                  Nenhum pedido em atraso no momento
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <ul class="order-list" id="listaPedidos">
      </ul>
    </div>
  </div>

  <div id="relatorioLoginModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-modal" onclick="fecharModal('relatorioLoginModal')">&times;</span>
      <h2>Acesso ao Relat√≥rio</h2>
      <form id="relatorioLoginForm" onsubmit="event.preventDefault(); verificarLoginRelatorio();">
        <div class="input-group">
          <label for="usuarioRelatorio">Usu√°rio</label>
          <input type="text" id="usuarioRelatorio" placeholder="Digite seu usu√°rio" required>
        </div>
        <div class="input-group">
          <label for="senhaRelatorio">Senha</label>
          <input type="password" id="senhaRelatorio" placeholder="Digite sua senha" required>
        </div>
        <button type="submit" class="btn btn-block">Acessar Relat√≥rio</button>
        <p class="error-message" id="relatorioErro" style="display: none;">Credenciais inv√°lidas!</p>
      </form>
    </div>
  </div>

  <div id="relatorioModal" class="modal" style="display: none;">
    <div class="modal-content large">
      <span class="close-modal" onclick="fecharModal('relatorioModal')">&times;</span>
      <h2>Relat√≥rio de Faturamento</h2>
      
      <div class="filter-group">
        <div class="input-group">
          <label for="dataInicio">Data In√≠cio</label>
          <input type="date" id="dataInicio" required>
        </div>
        <div class="input-group">
          <label for="dataFim">Data Fim</label>
          <input type="date" id="dataFim" required>
        </div>
      </div>
      
      <div class="filter-group">
        <div class="input-group">
          <label for="filtroStatus">Status</label>
          <select id="filtroStatus" class="input-group input">
            <option value="all">Todos</option>
            <option value="pending">Pendentes</option>
            <option value="preparing">Preparando</option>
            <option value="delivery">Entrega</option>
            <option value="completed">Conclu√≠dos</option>
          </select>
        </div>
        <div class="input-group">
          <label for="filtroMetodo">M√©todo</label>
          <select id="filtroMetodo" class="input-group input">
            <option value="all">Todos</option>
            <option value="delivery">Entrega</option>
            <option value="pickup">Retirada</option>
          </select>
        </div>
      </div>
      
      <button class="btn btn-block" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
      
      <div id="relatorioResultado" style="margin-top: 20px; display: none;">
        <div class="relatorio-header">
          <h3>Boteco do Cassim - Relat√≥rio de Faturamento</h3>
          <p id="periodoRelatorio"></p>
        </div>
        
        <div class="chart-container" style="height: 200px; margin-bottom: 20px;">
          <canvas id="relatorioChart"></canvas>
        </div>
        
        <table id="tabelaRelatorio" class="relatorio-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Pedido</th>
              <th>Cliente</th>
              <th>Itens</th>
              <th>Total</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="corpoRelatorio">
          </tbody>
          <tfoot>
            <tr>
              <td colspan="4" style="text-align: right;"><strong>Total Faturado:</strong></td>
              <td id="totalFaturado" colspan="2"><strong>R$ 0,00</strong></td>
            </tr>
          </tfoot>
        </table>
        
        <div class="export-buttons">
          <button class="btn btn-outline" onclick="window.print()">
            <i class="fas fa-file-pdf"></i> Exportar PDF
          </button>
          <button class="btn btn-outline" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i> Exportar Excel
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="cozinhaPrintModal" class="print-modal">
    <div class="print-content">
      <div class="print-header">
        <h1>COZINHA</h1>
        <p id="cozinhaPedidoInfo"></p>
      </div>
      <div id="cozinhaPedidoItens"></div>
      <div class="print-buttons">
        <button class="btn" onclick="imprimirCozinha()">
          <i class="fas fa-print"></i> Imprimir
        </button>
        <button class="btn btn-outline" onclick="fecharModal('cozinhaPrintModal')">
          <i class="fas fa-times"></i> Fechar
        </button>
      </div>
    </div>
  </div>

  <div id="entregaPrintModal" class="print-modal">
    <div class="print-content">
      <div class="print-header">
        <h1>Boteco do Cassim</h1>
        <p id="entregaPedidoInfo"></p>
      </div>
      <div id="entregaPedidoItens"></div>
      <div id="entregaPedidoTotal"></div>
      <div id="entregaPedidoPagamento"></div>
      <div class="print-buttons">
        <button class="btn" onclick="imprimirEntrega()">
          <i class="fas fa-print"></i> Imprimir
        </button>
        <button class="btn btn-outline" onclick="fecharModal('entregaPrintModal')">
          <i class="fas fa-times"></i> Fechar
        </button>
      </div>
    </div>
  </div>

  <div id="modalProdutosMaisVendidos" class="modal" style="display: none;">
    <div class="modal-content large">
      <span class="close-modal" onclick="fecharModal('modalProdutosMaisVendidos')">&times;</span>
      <h2>Produtos Mais Vendidos</h2>
      <div class="chart-container" style="height: 250px;">
        <canvas id="graficoProdutosMaisVendidos"></canvas>
      </div>
      <table class="relatorio-table">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Quantidade Vendida</th>
            <th>Total Arrecadado</th>
          </tr>
        </thead>
        <tbody id="tabelaProdutosMaisVendidos">
        </tbody>
      </table>
    </div>
  </div>

  <div id="modalFaturamentoDetalhado" class="modal" style="display: none;">
    <div class="modal-content large">
      <span class="close-modal" onclick="fecharModal('modalFaturamentoDetalhado')">&times;</span>
      <h2>Faturamento Dia/M√™s/Semana</h2>
      <div class="chart-container" style="height: 250px;">
        <canvas id="graficoFaturamentoDetalhado"></canvas>
      </div>
      <table class="relatorio-table">
        <thead>
          <tr>
            <th>Per√≠odo</th>
            <th>Dinheiro</th>
            <th>Cart√£o</th>
            <th>Pix</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="tabelaFaturamentoDetalhado">
        </tbody>
      </table>
    </div>
  </div>

  <div id="modalRankingClientes" class="modal" style="display: none;">
    <div class="modal-content large">
      <span class="close-modal" onclick="fecharModal('modalRankingClientes')">&times;</span>
      <h2>Ranking de Clientes</h2>
      <div class="filter-group">
        <div class="input-group">
          <label for="filtroPeriodoRanking">Per√≠odo</label>
          <select id="filtroPeriodoRanking" class="input-group input">
            <option value="semana">√öltima Semana</option>
            <option value="mes">√öltimo M√™s</option>
            <option value="todos">Todos os Pedidos</option>
          </select>
        </div>
      </div>
      <div class="chart-container" style="height: 250px;">
        <canvas id="graficoRankingClientes"></canvas>
      </div>
      <table class="relatorio-table">
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Telefone</th>
            <th>Total Gasto</th>
            <th>N¬∫ de Pedidos</th>
          </tr>
        </thead>
        <tbody id="tabelaRankingClientes">
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBHo3SWxux8a5vxRVO_SU-37bHNfLX86Sc",
      authDomain: "vaptvupt-delivery.firebaseapp.com",
      databaseURL: "https://vaptvupt-delivery-default-rtdb.firebaseio.com/",
      projectId: "vaptvupt-delivery",
      storageBucket: "vaptvupt-delivery.firebasestorage.app",
      messagingSenderId: "202472617537",
      appId: "1:202472617537:web:d327b2b5fe2f09ebf7b8c0",
      measurementId: "G-P3TXFL4XWD"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const senhaCorreta = "1234";
    let allOrders = [];
    let pedidosAnteriores = [];
    let statusChart, relatorioChart;
    let currentOrderId = null;

    const relatorioUsuario = "admin";
    const relatorioSenha = "1234";

    function initCharts() {     

      const ctxStatus = document.getElementById('statusChart').getContext('2d');
      statusChart = new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
          labels: ['Pendentes', 'Preparando', 'Entrega', 'Conclu√≠dos'],
          datasets: [{
            data: [0, 0, 0, 0],
            backgroundColor: [
              'rgba(255, 193, 7, 0.7)',
              'rgba(255, 107, 0, 0.7)',
              'rgba(33, 150, 243, 0.7)',
              'rgba(76, 175, 80, 0.7)'
            ],
            borderColor: [
              'rgba(255, 193, 7, 1)',
              'rgba(255, 107, 0, 1)',
              'rgba(33, 150, 243, 1)',
              'rgba(76, 175, 80, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: '#e0e0e0'
              }
            }
          }
        }
      });
    }

    function updateLateOrdersDashboard() {
      const now = new Date();
      const lateThreshold = 5 * 1000;
      const lateOrdersBody = document.getElementById('late-orders-body');
      
      const lateOrders = allOrders.filter(order => {
        const orderTime = new Date(order.data);
        const timeDiff = now - orderTime;
        
        return (
          (order.status === 'Aguardando confirma√ß√£o' || 
           order.status.includes('iniciando')) && 
          timeDiff > lateThreshold
        );
      });
      
      lateOrdersBody.innerHTML = '';
      
      if (lateOrders.length === 0) {
        lateOrdersBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">
              Nenhum pedido em atraso no momento
            </td>
          </tr>
        `;
        return;
      }
      
      lateOrders.sort((a, b) => new Date(a.data) - new Date(b.data));
      
      lateOrders.forEach(order => {
        const orderTime = new Date(order.data);
        const timeDiff = now - orderTime;
        const minutesLate = Math.floor(timeDiff / (60 * 1000));
        
        let statusText = 'Aguardando Aceite';
        let statusClass = 'status-pending';
        let actionButton = '';
        
        if (order.status.includes('iniciando')) {
          statusText = 'Preparando pedido';
          statusClass = 'status-preparing';
          actionButton = `
            <button class="btn btn-sm btn-warning" onclick="confirmarEnviarEntrega('${order.id}')">
              Enviar para Entrega
            </button>
          `;
        } else {
         actionButton = `
            <button class="btn btn-sucess btn-sm" onclick="confirmarAceitarPedido('${order.id}')">
              Aceitar Pedido
            </button>
          `;
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${order.id.substring(0, 8)}</td>
          <td>${order.cliente.nome}</td>
          <td>${minutesLate} minutos de atraso</td>
          <td class="${statusClass}">${statusText}</td>
          <td>${actionButton}</td>
        `;
        
        lateOrdersBody.appendChild(row);
      });
    }

    function updateCharts() {
      const hoje = new Date();
      const ultimos7Dias = [];
      const faturamentoPorDia = [];
      
      for (let i = 6; i >= 0; i--) {
        const data = new Date();
        data.setDate(hoje.getDate() - i);
        ultimos7Dias.push(data.toLocaleDateString('pt-BR', {day: 'numeric', month: 'short'}));
        
        const dataInicio = new Date(data);
        dataInicio.setHours(0, 0, 0, 0);
        const dataFim = new Date(data);
        dataFim.setHours(23, 59, 59, 999);
        
        const faturamento = allOrders
          .filter(p => {
            const dataPedido = new Date(p.data);
            return dataPedido >= dataInicio && dataPedido <= dataFim && p.status.includes('entregue');
          })
          .reduce((total, p) => total + p.total, 0);
          
        faturamentoPorDia.push(faturamento);
      }
      
      const pending = allOrders.filter(o => o.status === 'Aguardando confirma√ß√£o').length;
      const preparing = allOrders.filter(o => o.status.includes('iniciando')).length;
      const delivery = allOrders.filter(o => o.status.includes('entrega') && !o.status.includes('entregue')).length;
      const completed = allOrders.filter(o => o.status.includes('entregue')).length;
      
      statusChart.data.datasets[0].data = [pending, preparing, delivery, completed];
      statusChart.update();
    }

    function showToast(message) {
      const toast = document.getElementById('toastNotification');
      toast.querySelector('span').textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 5000);
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('show');
    }

    function tocarSomNotificacao() {
      const som = document.getElementById('somNotificacao');
      if (som) som.play();
    }

    function verificarSenha() {
      const senhaDigitada = document.getElementById('senhaInput').value;
      if (senhaDigitada === senhaCorreta) {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('painelPedidos').style.display = 'block';
        initCharts();
        carregarPedidosFirebase();
        setInterval(updateLateOrdersDashboard, 5000);
        
        if (window.innerWidth <= 992) {
          document.getElementById('toggleSidebar').style.display = 'block';
        }
      } else {
        document.getElementById('mensagemErro').style.display = 'block';
        const form = document.getElementById('loginFormElement');
        form.style.animation = 'shake 0.5s';
        setTimeout(() => form.style.animation = '', 500);
      }
    }

    const style = document.createElement('style');
    style.textContent = `
      @keyframes shake {
        0%, 100% { transform: translateX(0); }
        20%, 60% { transform: translateX(-5px); }
        40%, 80% { transform: translateX(5px); }
      }
    `;
    document.head.appendChild(style);

    function carregarPedidosFirebase() {
      const pedidosRef = database.ref('pedidos');
      
      pedidosRef.on('value', (snapshot) => {
        allOrders = [];
        const novosIds = [];
        snapshot.forEach((childSnapshot) => {
        const pedido = childSnapshot.val();
        pedido.id = pedido.numeroPedido || childSnapshot.key;
        allOrders.push(pedido);
        novosIds.push(pedido.id);
      });

        const novosPedidos = novosIds.filter(id => !pedidosAnteriores.includes(id));
        if (pedidosAnteriores.length > 0 && novosPedidos.length > 0) {
          tocarSomNotificacao();
          showToast('üö® Novo pedido recebido!');
        }
        pedidosAnteriores = novosIds;
        
        carregarPedidos();
        updateStats();
        updateCharts();
        updateLateOrdersDashboard();
      });
    }

    function calcularTempoDecorrido(dataPedido) {
      const agora = new Date();
      const data = new Date(dataPedido);
      const diffMs = agora - data;
      const diffMins = Math.round(diffMs / 60000);
      
      if (diffMins < 60) {
        return `${diffMins} min`;
      } else {
        const diffHours = Math.floor(diffMins / 60);
        const remainingMins = diffMins % 60;
        return `${diffHours}h ${remainingMins}min`;
      }
    }

    function carregarPedidos() {
      const container = document.getElementById('listaPedidos');
      container.innerHTML = '';

      if (allOrders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>Nenhum pedido encontrado</p>
            <button class="btn" onclick="carregarPedidosFirebase()">Atualizar</button>
          </div>
        `;
        return;
      }

      allOrders.sort((a, b) => new Date(b.data) - new Date(a.data));

      allOrders.forEach((pedido, index) => {
        const pedidoHTML = document.createElement('li');
        pedidoHTML.classList.add('order-item');
        
        let statusClass = 'status-pending';
        let statusText = 'Pendente';
        if (pedido.status.includes('iniciando')) {
          statusClass = 'status-preparing';
          statusText = 'Preparando';
        } else if (pedido.status.includes('entrega')) {
          statusClass = 'status-delivery';
          statusText = 'Saiu para entrega';
        } else if (pedido.status.includes('entregue')) {
          statusClass = 'status-completed';
          statusText = 'Conclu√≠do';
        }

        const tempoDecorrido = calcularTempoDecorrido(pedido.data);
        let tempoTexto = '';
        if (statusText === 'Pendente') {
          tempoTexto = `Pendente h√° ${tempoDecorrido}`;
        } else if (statusText === 'Preparando') {
          tempoTexto = `Preparando h√° ${tempoDecorrido}`;
        } else if (statusText === 'Saiu para entrega') {
          tempoTexto = `Em entrega h√° ${tempoDecorrido}`;
        }

        pedidoHTML.innerHTML = `
          <div class="order-header">
            <span class="order-id">Pedido #${pedido.id}</span>
            <span class="order-time">${formatDate(pedido.data)}</span>
          </div>
          <div class="order-customer">
            <div class="customer-avatar">${pedido.cliente.nome.charAt(0).toUpperCase()}</div>
            <div class="customer-info">
              <h4>${pedido.cliente.nome}</h4>
              <p>${pedido.cliente.telefone}</p>
              <p><i class="fas fa-map-marker-alt"></i> ${pedido.cliente.endereco || 'Endere√ßo n√£o informado'}</p>
<p><i class="fas fa-wallet"></i> Forma de pagamento: ${pedido.pagamento || 'N√£o informado'}</p>

            </div>
          </div>
          <div class="order-status ${statusClass}">${statusText}</div>
          ${tempoTexto ? `<div class="time-indicator"><i class="fas fa-clock"></i> ${tempoTexto}</div>` : ''}
          <div class="order-details">
            <ul class="order-items">
              ${pedido.itens.map(item => `
                <li class="order-item-row">
                  <span>${item.nome} (x${item.quantidade}) ${item.observacoes ? `<br><small>${item.observacoes}</small>` : ''}</span>
                  <span>R$ ${(item.preco * item.quantidade).toFixed(2)}</span>
                </li>
              `).join('')}
            </ul>
            <div class="order-total">
              <span>Total</span>
              <span>R$ ${pedido.total.toFixed(2)}</span>
            </div>
          </div>
          <div class="order-actions">
<button class="btn btn-sm btn-outline" onclick="prepararImpressaoCozinha(\'${pedido.id}\')"><i class="fas fa-print"></i> Imprimir Cozinha</button>
<button class="btn btn-sm btn-outline" onclick="prepararImpressaoEntrega(\'${pedido.id}\')"><i class="fas fa-print"></i> Imprimir Entrega</button>
            ${statusText === 'Pendente' ? `
              <button class="btn btn-sm" onclick="confirmarAceitarPedido('${pedido.id}')">
                <i class="fas fa-check"></i> Aceitar
              </button>
            ` : ''}
            ${statusText === 'Preparando' ? `
              <button class="btn btn-sm btn-warning" onclick="confirmarEnviarEntrega('${pedido.id}')">
                <i class="fas fa-motorcycle"></i> Saiu para Entrega
              </button>
            ` : ''}
            ${statusText === 'Saiu para entrega' ? `
              <button class="btn btn-sm btn-success" onclick="updateOrderStatus('${pedido.id}', 'completed')">
                <i class="fas fa-check-circle"></i> Finalizar
              </button>
            ` : ''}
            <button class="btn btn-sm btn-outline" onclick="viewOrderDetails('${pedido.id}')">
              <i class="fas fa-eye"></i> Detalhes
            </button>
            ${pedido.cliente.endereco ? `
              <button class="btn btn-sm btn-info" onclick="abrirMapa('${pedido.cliente.endereco}')">
                <i class="fas fa-map-marked-alt"></i> Mapa
              </button>
            ` : ''}
          </div>
        `;

        container.appendChild(pedidoHTML);
      });
    }

    function abrirMapa(endereco) {
      const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(endereco)}`;
      window.open(url, '_blank');
    }

    function confirmarAceitarPedido(pedidoId) {
      currentOrderId = pedidoId;
      updateOrderStatus(pedidoId, 'preparing');
    }

    function confirmarEnviarEntrega(pedidoId) {
      currentOrderId = pedidoId;
      updateOrderStatus(pedidoId, 'delivery');
    }

    function prepararImpressaoCozinha(pedidoId) {
      const pedido = allOrders.find(p => p.id === pedidoId);
      if (!pedido) return;
      
      document.getElementById('cozinhaPedidoInfo').innerHTML = `
        <strong>Pedido:</strong> #${pedidoId}<br>
        <strong>Cliente:</strong> ${pedido.cliente.nome}<br>
        ${pedido.cliente.telefone ? `<strong>Telefone:</strong> ${pedido.cliente.telefone}<br>` : ''}
      `;
      
      document.getElementById('cozinhaPedidoItens').innerHTML = `
        <hr>
        ${pedido.itens.map(item => `
          <p><strong>${item.nome} (x${item.quantidade})</strong> ${item.observacoes ? `<br><em>${item.observacoes}</em>` : ''}</p>
        `).join('')}
        <hr>
      `;
      
      document.getElementById('cozinhaPrintModal').style.display = 'block';
    }

    function prepararImpressaoEntrega(pedidoId) {
      const pedido = allOrders.find(p => p.id === pedidoId);
      if (!pedido) return;
      
      document.getElementById('entregaPedidoInfo').innerHTML = `
        <strong>Pedido:</strong> #${pedidoId}<br>
        <strong>Cliente:</strong> ${pedido.cliente.nome}<br>
        <strong>Telefone:</strong> ${pedido.cliente.telefone}<br>
        <strong>Endere√ßo:</strong> ${pedido.cliente.endereco || 'Retirada no local'}<br>
        <strong>Bairro:</strong> ${pedido.cliente.bairro}<br>
      `;
      
      document.getElementById('entregaPedidoItens').innerHTML = `
        <hr>
        ${pedido.itens.map(item => `
          <p><strong>${item.nome} (x${item.quantidade})</strong> - R$ ${(item.preco * item.quantidade).toFixed(2)}</p>
        `).join('')}
      `;
      
      document.getElementById('entregaPedidoTotal').innerHTML = `
        <hr>
        <p><strong>Total:</strong> R$ ${pedido.total.toFixed(2)}</p>
      `;
      
      document.getElementById('entregaPedidoPagamento').innerHTML = `
        <p><strong>Pagamento:</strong> ${pedido.pagamento || 'N√£o informado'}</p>
        <hr>
      `;
      
      document.getElementById('entregaPrintModal').style.display = 'block';
    }

    function imprimirCozinha() {
      window.print();
    }

    function imprimirEntrega() {
      window.print();
    }

    function updateOrderStatus(pedidoId, status) {
      let newStatus = '';
      switch(status) {
        case 'preparing':
          newStatus = 'Cozinha est√° iniciando seu pedido';
          break;
        case 'delivery':
          newStatus = 'Pedido saiu para entrega';
          break;
        case 'completed':
          newStatus = 'Pedido entregue';
          break;
        default:
          newStatus = 'Aguardando confirma√ß√£o';
      }
      
      const button = event.target.closest('button');
      if (button) {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
        button.disabled = true;
        
        setTimeout(() => {
          button.innerHTML = originalText;
          button.disabled = false;
        }, 2000);
      }
      
      database.ref('pedidos/' + pedidoId).update({ 
        status: newStatus,
        ultimaAtualizacao: firebase.database.ServerValue.TIMESTAMP 
      })
      .then(() => {
        console.log("Status atualizado com sucesso!");
        updateLateOrdersDashboard();
      })
      .catch(error => {
        console.error("Erro ao atualizar status:", error);
        alert("Ocorreu um erro ao atualizar o status do pedido");
      });
    }

    function viewOrderDetails(pedidoId) {
      const pedido = allOrders.find(p => p.id === pedidoId);
      if (!pedido) return;
      
      alert(`Detalhes do Pedido\n\nCliente: ${pedido.cliente.nome}\nTelefone: ${pedido.cliente.telefone}\nEndere√ßo: ${pedido.cliente.endereco}\n\nItens:\n${
        pedido.itens.map(item => `- ${item.nome} (x${item.quantidade}) - R$ ${(item.preco * item.quantidade).toFixed(2)}${item.observacoes ? `\n  Obs: ${item.observacoes}` : ''}`).join('\n')
      }\n\nTotal: R$ ${pedido.total.toFixed(2)}\n\nStatus: ${pedido.status}`);
    }

    function filterOrders(filter) {
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
      
      let filteredOrders = allOrders;
      if (filter !== 'all') {
        filteredOrders = allOrders.filter(pedido => {
          if (filter === 'pending') return pedido.status === 'Aguardando confirma√ß√£o';
          if (filter === 'preparing') return pedido.status.includes('iniciando');
          if (filter === 'delivery') return pedido.status.includes('entrega') && !pedido.status.includes('entregue');
          if (filter === 'completed') return pedido.status.includes('entregue');
          return true;
        });
      }
      
      const container = document.getElementById('listaPedidos');
      container.innerHTML = '';
      
      if (filteredOrders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>Nenhum pedido encontrado nesta categoria</p>
          </div>
        `;
        return;
      }
      
      filteredOrders.forEach((pedido, index) => {
        const pedidoHTML = document.createElement('li');
        pedidoHTML.classList.add('order-item');
        
        let statusClass = 'status-pending';
        let statusText = 'Pendente';
        if (pedido.status.includes('iniciando')) {
          statusClass = 'status-preparing';
          statusText = 'Preparando';
        } else if (pedido.status.includes('entrega')) {
          statusClass = 'status-delivery';
          statusText = 'Saiu para entrega';
        } else if (pedido.status.includes('entregue')) {
          statusClass = 'status-completed';
          statusText = 'Conclu√≠do';
        }

        const tempoDecorrido = calcularTempoDecorrido(pedido.data);
        let tempoTexto = '';
        if (statusText === 'Pendente') {
          tempoTexto = `Pendente h√° ${tempoDecorrido}`;
        } else if (statusText === 'Preparando') {
          tempoTexto = `Preparando h√° ${tempoDecorrido}`;
        } else if (statusText === 'Saiu para entrega') {
          tempoTexto = `Em entrega h√° ${tempoDecorrido}`;
        }

        pedidoHTML.innerHTML = `
          <div class="order-header">
            <span class="order-id">Pedido #${pedido.id}</span>
            <span class="order-time">${formatDate(pedido.data)}</span>
          </div>
          <div class="order-customer">
            <div class="customer-avatar">${pedido.cliente.nome.charAt(0).toUpperCase()}</div>
            <div class="customer-info">
              <h4>${pedido.cliente.nome}</h4>
              <p>${pedido.cliente.telefone}</p>
              <p><i class="fas fa-map-marker-alt"></i> ${pedido.cliente.endereco || 'Endere√ßo n√£o informado'}</p>
<p><i class="fas fa-wallet"></i> Forma de pagamento: ${pedido.pagamento || 'N√£o informado'}</p>

            </div>
          </div>
          <div class="order-status ${statusClass}">${statusText}</div>
          ${tempoTexto ? `<div class="time-indicator"><i class="fas fa-clock"></i> ${tempoTexto}</div>` : ''}
          <div class="order-details">
            <ul class="order-items">
              ${pedido.itens.map(item => `
                <li class="order-item-row">
                  <span>${item.nome} (x${item.quantidade}) ${item.observacoes ? `<br><small>${item.observacoes}</small>` : ''}</span>
                  <span>R$ ${(item.preco * item.quantidade).toFixed(2)}</span>
                </li>
              `).join('')}
            </ul>
            <div class="order-total">
              <span>Total</span>
              <span>R$ ${pedido.total.toFixed(2)}</span>
            </div>
          </div>
          <div class="order-actions">
<button class="btn btn-sm btn-outline" onclick="prepararImpressaoCozinha(\'${pedido.id}\')"><i class="fas fa-print"></i> Imprimir Cozinha</button>
<button class="btn btn-sm btn-outline" onclick="prepararImpressaoEntrega(\'${pedido.id}\')"><i class="fas fa-print"></i> Imprimir Entrega</button>
            ${statusText === 'Pendente' ? `
              <button class="btn btn-sm" onclick="confirmarAceitarPedido('${pedido.id}')">
                <i class="fas fa-check"></i> Aceitar
              </button>
            ` : ''}
            ${statusText === 'Preparando' ? `
              <button class="btn btn-sm btn-warning" onclick="confirmarEnviarEntrega('${pedido.id}')">
                <i class="fas fa-motorcycle"></i> Saiu para Entrega
              </button>
            ` : ''}
            ${statusText === 'Saiu para entrega' ? `
              <button class="btn btn-sm btn-success" onclick="updateOrderStatus('${pedido.id}', 'completed')">
                <i class="fas fa-check-circle"></i> Finalizar
              </button>
            ` : ''}
            <button class="btn btn-sm btn-outline" onclick="viewOrderDetails('${pedido.id}')">
              <i class="fas fa-eye"></i> Detalhes
            </button>
            ${pedido.cliente.endereco ? `
              <button class="btn btn-sm btn-info" onclick="abrirMapa('${pedido.cliente.endereco}')">
                <i class="fas fa-map-marked-alt"></i> Mapa
              </button>
            ` : ''}
          </div>
        `;

        container.appendChild(pedidoHTML);
      });
    }

    function updateStats() {
      const pending = allOrders.filter(o => o.status === 'Aguardando confirma√ß√£o').length;
      const preparing = allOrders.filter(o => o.status.includes('iniciando')).length;
      const delivery = allOrders.filter(o => o.status.includes('entrega') && !o.status.includes('entregue')).length;
      const completed = allOrders.filter(o => o.status.includes('entregue')).length;
      
      document.getElementById('stat-pending').textContent = pending;
      document.getElementById('stat-preparing').textContent = preparing;
      document.getElementById('stat-delivery').textContent = delivery;
      document.getElementById('stat-completed').textContent = completed;
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleString('pt-BR');
    }

    function abrirRelatorioLogin() {
      document.getElementById('relatorioLoginModal').style.display = 'block';
    }

    function fecharModal(id) {
      document.getElementById(id).style.display = 'none';
    }

    function verificarLoginRelatorio() {
      const usuario = document.getElementById('usuarioRelatorio').value;
      const senha = document.getElementById('senhaRelatorio').value;

      const usuarioRef = database.ref(`usuarios/${usuario}`);
      usuarioRef.once('value').then(snapshot => {
        if (snapshot.exists()) {
          const dados = snapshot.val();
          if (dados.senha === senha && dados.tipo === "admin") {
            document.getElementById('relatorioLoginModal').style.display = 'none';
            document.getElementById('relatorioModal').style.display = 'block';
            document.getElementById('relatorioErro').style.display = 'none';

            const hoje = new Date();
            const seteDiasAtras = new Date();
            seteDiasAtras.setDate(hoje.getDate() - 7);

            document.getElementById('dataInicio').valueAsDate = seteDiasAtras;
            document.getElementById('dataFim').valueAsDate = hoje;
          } else {
            exibirErroLogin();
          }
        } else {
          exibirErroLogin();
        }
      }).catch(error => {
        console.error("Erro ao consultar o Firebase:", error);
        exibirErroLogin();
      });

      function exibirErroLogin() {
        document.getElementById('relatorioErro').style.display = 'block';
        const form = document.getElementById('relatorioLoginForm');
        form.style.animation = 'shake 0.5s';
        setTimeout(() => form.style.animation = '', 500);
      }
    }

    function initRelatorioChart(data, labels) {
      const ctx = document.getElementById('relatorioChart').getContext('2d');
      
      if (relatorioChart) {
        relatorioChart.destroy();
      }
      
      relatorioChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Faturamento (R$)',
            data: data,
            backgroundColor: 'rgba(255, 107, 0, 0.7)',
            borderColor: 'rgba(255, 107, 0, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#e0e0e0'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: '#e0e0e0'
              }
            }
          }
        }
      });
    }

    function gerarRelatorio() {
      const dataInicioInput = document.getElementById('dataInicio').value;
      const dataFimInput = document.getElementById('dataFim').value;
      const [anoI, mesI, diaI] = dataInicioInput.split('-').map(Number);
      const [anoF, mesF, diaF] = dataFimInput.split('-').map(Number);
      const dataInicio = new Date(anoI, mesI - 1, diaI);
      const dataFim = new Date(anoF, mesF - 1, diaF);
      const filtroStatus = document.getElementById('filtroStatus').value;
      const filtroMetodo = document.getElementById('filtroMetodo').value;
      
      if (dataInicio > dataFim) {
        alert("A data de in√≠cio n√£o pode ser maior que a data final!");
        return;
      }
      
      const dataInicioDia = new Date(dataInicio.getFullYear(), dataInicio.getMonth(), dataInicio.getDate());
      const dataFimDia = new Date(dataFim.getFullYear(), dataFim.getMonth(), dataFim.getDate());
      let pedidosFiltrados = allOrders.filter(pedido => {
        const dataPedido = new Date(pedido.data);
        const dataPedidoDia = new Date(dataPedido.getFullYear(), dataPedido.getMonth(), dataPedido.getDate());
        return dataPedidoDia >= dataInicioDia && dataPedidoDia <= dataFimDia;
      });
      
      if (filtroStatus !== 'all') {
        pedidosFiltrados = pedidosFiltrados.filter(pedido => {
          if (filtroStatus === 'pending') return pedido.status === 'Aguardando confirma√ß√£o';
          if (filtroStatus === 'preparing') return pedido.status.includes('iniciando');
          if (filtroStatus === 'delivery') return pedido.status.includes('entrega') && !pedido.status.includes('entregue');
          if (filtroStatus === 'completed') return pedido.status.includes('entregue');
          return true;
        });
      }
      
      if (filtroMetodo !== 'all') {
        pedidosFiltrados = pedidosFiltrados.filter(pedido => {
          if (filtroMetodo === 'delivery') return pedido.metodo === 'entrega';
          if (filtroMetodo === 'pickup') return pedido.metodo === 'retirada';
          return true;
        });
      }
      
      if (pedidosFiltrados.length === 0) {
        alert("Nenhum pedido encontrado com os filtros selecionados!");
        return;
      }
      
      pedidosFiltrados.sort((a, b) => new Date(a.data) - new Date(b.data));
      
      const dias = [];
      const faturamentoPorDia = [];
      
      const pedidosPorDia = {};
      pedidosFiltrados.forEach(pedido => {
        const data = new Date(pedido.data);
        const dia = data.toLocaleDateString('pt-BR');
        
        if (!pedidosPorDia[dia]) {
          pedidosPorDia[dia] = {
            total: 0,
            pedidos: []
          };
        }
        
        pedidosPorDia[dia].total += pedido.total;
        pedidosPorDia[dia].pedidos.push(pedido);
      });
      
      Object.keys(pedidosPorDia).forEach(dia => {
        dias.push(dia);
        faturamentoPorDia.push(pedidosPorDia[dia].total);
      });
      
      initRelatorioChart(faturamentoPorDia, dias);
      
      const corpoRelatorio = document.getElementById('corpoRelatorio');
      corpoRelatorio.innerHTML = '';
      
      let totalFaturado = 0;
      let contadorPedido = 1;
      
      Object.keys(pedidosPorDia).forEach(dia => {
        const pedidosDia = pedidosPorDia[dia].pedidos;
        
        pedidosDia.forEach((pedido, index) => {
          const tr = document.createElement('tr');
          
          const itensFormatados = pedido.itens.map(item => 
            `${item.nome} (x${item.quantidade}) - R$ ${(item.preco * item.quantidade).toFixed(2)}`
          ).join('<br>');
          
          let status = 'Pendente';
          if (pedido.status.includes('iniciando')) status = 'Preparando';
          else if (pedido.status.includes('entrega') && !pedido.status.includes('entregue')) status = 'Entrega';
          else if (pedido.status.includes('entregue')) status = 'Conclu√≠do';
          
          tr.innerHTML = `
            <td>${formatDate(pedido.data)}</td>
            <td>#${contadorPedido}</td>
            <td>${pedido.cliente.nome}</td>
            <td>${itensFormatados}</td>
            <td>R$ ${pedido.total.toFixed(2)}</td>
            <td>${status}</td>
          `;
          
          corpoRelatorio.appendChild(tr);
          totalFaturado += pedido.total;
          contadorPedido++;
        });
      });
      
      document.getElementById('periodoRelatorio').textContent = 
        `Per√≠odo: ${dataInicio.toLocaleDateString('pt-BR')} at√© ${dataFim.toLocaleDateString('pt-BR')} | 
        ${pedidosFiltrados.length} pedidos`;
      
      document.getElementById('totalFaturado').innerHTML = 
        `<strong>R$ ${totalFaturado.toFixed(2)}</strong>`;
      
      document.getElementById('relatorioResultado').style.display = 'block';
    }
    
    function exportToExcel() {
      let csv = 'Data,Pedido,Cliente,Itens,Total,Status\n';
      
      const rows = document.querySelectorAll('#corpoRelatorio tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = [];
        
        cells.forEach((cell, index) => {
          let text = cell.textContent || cell.innerText;
          text = text.replace(/\n/g, '; ').replace(/,/g, ';');
          
          if (text.indexOf(',') > -1) {
            text = `"${text}"`;
          }
          
          rowData.push(text);
        });
        
        csv += rowData.join(',') + '\n';
      });
      
      const total = document.getElementById('totalFaturado').textContent;
      csv += `\n,,,Total Faturado,${total},`;
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.setAttribute('href', url);
      link.setAttribute('download', `relatorio_boteco_${new Date().toISOString().slice(0,10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    window.addEventListener('resize', function() {
      if (window.innerWidth <= 992) {
        document.getElementById('toggleSidebar').style.display = 'block';
      } else {
        document.getElementById('toggleSidebar').style.display = 'none';
        document.getElementById('sidebar').classList.remove('show');
      }
    });
  
    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('painelPedidos').style.display = 'block';
      initCharts();
      carregarPedidosFirebase();
      setInterval(updateLateOrdersDashboard, 5000);
      if (window.innerWidth <= 992) {
        document.getElementById('toggleSidebar').style.display = 'block';
      }
    });

    function abrirRelatorioProdutosMaisVendidos() {
      gerarRelatorioProdutosMaisVendidos();
      document.getElementById('modalProdutosMaisVendidos').style.display = 'block';
    }

    function abrirRelatorioFaturamentoDetalhado() {
      gerarRelatorioFaturamentoDetalhado();
      document.getElementById('modalFaturamentoDetalhado').style.display = 'block';
    }

    function abrirRelatorioRankingClientes() {
      gerarRelatorioRankingClientes();
      document.getElementById('modalRankingClientes').style.display = 'block';
    }

    function gerarRelatorioProdutosMaisVendidos() {
      const mapa = {};
      allOrders.forEach(p => {
        if (p.itens) {
          p.itens.forEach(item => {
            if (!mapa[item.nome]) {
              mapa[item.nome] = { qtd: 0, total: 0 };
            }
            mapa[item.nome].qtd += item.quantidade;
            mapa[item.nome].total += item.quantidade * item.preco;
          });
        }
      });

      const dados = Object.entries(mapa).sort((a, b) => b[1].qtd - a[1].qtd);
      const corpo = document.getElementById('tabelaProdutosMaisVendidos');
      corpo.innerHTML = '';
      const labels = [], valores = [];

      dados.forEach(([nome, { qtd, total }]) => {
        labels.push(nome);
        valores.push(qtd);
        corpo.innerHTML += `<tr><td>${nome}</td><td>${qtd}</td><td>R$ ${total.toFixed(2)}</td></tr>`;
      });

      const ctx = document.getElementById('graficoProdutosMaisVendidos').getContext('2d');
      if (window.produtosChart) window.produtosChart.destroy();
      window.produtosChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Quantidade Vendida',
            data: valores,
            backgroundColor: 'rgba(255, 107, 0, 0.7)'
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    function gerarRelatorioFaturamentoDetalhado() {
      const mapa = {};

      allOrders.forEach(p => {
        if (p.status.includes('entregue')) {
          const d = new Date(p.data);
          const dia = d.toLocaleDateString('pt-BR');
          if (!mapa[dia]) {
            mapa[dia] = { dinheiro: 0, cartao: 0, pix: 0, total: 0 };
          }
          const forma = (p.pagamento || '').toLowerCase();
          const val = p.total;
          if (forma.includes("dinheiro")) mapa[dia].dinheiro += val;
          else if (forma.includes("pix")) mapa[dia].pix += val;
          else mapa[dia].cartao += val;
          mapa[dia].total += val;
        }
      });

      const dias = Object.keys(mapa).sort();
      const corpo = document.getElementById('tabelaFaturamentoDetalhado');
      corpo.innerHTML = '';
      const totais = dias.map(dia => {
        const d = mapa[dia];
        corpo.innerHTML += `<tr><td>${dia}</td><td>R$ ${d.dinheiro.toFixed(2)}</td><td>R$ ${d.cartao.toFixed(2)}</td><td>R$ ${d.pix.toFixed(2)}</td><td><strong>R$ ${d.total.toFixed(2)}</strong></td></tr>`;
        return d.total;
      });

      const ctx = document.getElementById('graficoFaturamentoDetalhado').getContext('2d');
      if (window.faturamentoChartExtra) window.faturamentoChartExtra.destroy();
      window.faturamentoChartExtra = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dias,
          datasets: [{
            label: 'Faturamento Total',
            data: totais,
            backgroundColor: 'rgba(255, 107, 0, 0.2)',
            borderColor: 'rgba(255, 107, 0, 1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } }
        }
      });
    }

    function gerarRelatorioRankingClientes() {
      const periodo = document.getElementById('filtroPeriodoRanking').value;
      const hoje = new Date();
      let dataInicio = new Date(0);
      
      if (periodo === 'semana') {
        dataInicio = new Date();
        dataInicio.setDate(hoje.getDate() - 7);
      } else if (periodo === 'mes') {
        dataInicio = new Date();
        dataInicio.setMonth(hoje.getMonth() - 1);
      }
      
      const clientes = {};

      allOrders.forEach(p => {
        if (!p.cliente || !p.cliente.nome || !p.cliente.telefone) return;
        
        const dataPedido = new Date(p.data);
        if (dataPedido < dataInicio) return;
        
        const telefone = p.cliente.telefone;
        if (!clientes[telefone]) {
          clientes[telefone] = { 
            nome: p.cliente.nome,
            telefone: telefone,
            total: 0, 
            pedidos: 0 
          };
        }
        clientes[telefone].total += p.total;
        clientes[telefone].pedidos += 1;
      });

      const ranking = Object.values(clientes).sort((a, b) => b.total - a.total);
      const corpo = document.getElementById('tabelaRankingClientes');
      corpo.innerHTML = '';
      const labels = [], valores = [];

      ranking.forEach(cliente => {
        corpo.innerHTML += `
          <tr>
            <td>${cliente.nome}</td>
            <td>${cliente.telefone}</td>
            <td>R$ ${cliente.total.toFixed(2)}</td>
            <td>${cliente.pedidos}</td>
          </tr>
        `;
        labels.push(cliente.nome);
        valores.push(cliente.total);
      });

      const ctx = document.getElementById('graficoRankingClientes').getContext('2d');
      if (window.clientesChart) window.clientesChart.destroy();
      window.clientesChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Total Gasto',
            data: valores,
            backgroundColor: 'rgba(255, 107, 0, 0.7)'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } }
        }
      });
    }
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBHo3SWxux8a5vxRVO_SU-37bHNfLX86Sc",
      authDomain: "vaptvupt-delivery.firebaseapp.com",
      projectId: "vaptvupt-delivery",
      storageBucket: "vaptvupt-delivery.firebasestorage.app",
      messagingSenderId: "202472617537",
      appId: "1:202472617537:web:d327b2b5fe2f09ebf7b8c0"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('painelPedidos').style.display = 'block';
        if (typeof carregarPedidosFirebase === 'function') carregarPedidosFirebase();
        setInterval(updateLateOrdersDashboard, 5000);
      } else {
        document.getElementById('loginForm').style.display = 'flex';
        document.getElementById('painelPedidos').style.display = 'none';
      }
    });

    window.realizarLogin = function () {
      const email = document.getElementById('emailInput').value;
      const senha = document.getElementById('senhaInput').value;
      signInWithEmailAndPassword(auth, email, senha)
        .catch(() => {
          document.getElementById('mensagemErro').style.display = 'block';
        });
    };

    window.logout = function () {
      signOut(auth);
    };
  </script>

  <audio id="somNotificacao" src="notificacao.mp3" preload="auto"></audio>

  <script>
    document.addEventListener('click', () => {
      const som = document.getElementById('somNotificacao');
      if (som) som.play().catch(() => {});
    }, { once: true });
  </script>

<audio id="somNotificacao">
  <source src="notificacao.mp3" type="audio/mpeg">
  Seu navegador n√£o suporta √°udio.
</audio>


<div id="modalInserirProduto" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="fecharModal('modalInserirProduto')">&times;</span>
    <h2>Inserir Novo Produto</h2>
    <form id="formNovoProduto">
      <div class="input-group">
        <label for="produtoNome">Nome do Produto</label>
        <input type="text" id="produtoNome" required>
      </div>
      <div class="input-group">
        <label for="produtoPreco">Pre√ßo (R$)</label>
        <input type="number" step="0.01" id="produtoPreco" required>
      </div>
      <div class="input-group">
        <label for="produtoImagem">URL da Imagem</label>
        <input type="url" id="produtoImagem" required>
      </div>
      <div class="input-group">
        <label for="produtoCategoria">Categoria</label>
        <input type="text" id="produtoCategoria" required>
      </div>
      <button type="submit" class="btn btn-block">Adicionar Produto</button>
    </form>
  </div>
</div>

<script>
  function abrirModalInserirProduto() {
    document.getElementById('modalInserirProduto').style.display = 'block';
  }
  function fecharModal(id) {
    document.getElementById(id).style.display = 'none';
  }

 const db = firebase.database();

  document.getElementById('formNovoProduto').addEventListener('submit', function(e) {
    e.preventDefault();
    const nome = document.getElementById('produtoNome').value;
    const preco = parseFloat(document.getElementById('produtoPreco').value);
    const imagem = document.getElementById('produtoImagem').value;
    const categoria = document.getElementById('produtoCategoria').value.toLowerCase();

    const novoProduto = {
      nome,
      preco,
      imagem,
      categoria
    };

    db.ref(`produtos/${categoria}`).push(novoProduto).then(() => {
      alert('Produto adicionado com sucesso!');
      document.getElementById('formNovoProduto').reset();
      fecharModal('modalInserirProduto');
    }).catch(error => {
      alert('Erro ao adicionar produto: ' + error.message);
    });
  });
</script>

<!-- √Åudio e prote√ß√µes -->
<audio id="somNotificacao" src="notificacao.mp3" preload="auto"></audio>

<script>
  document.addEventListener('click', () => {
    const som = document.getElementById('somNotificacao');
    if (som) som.play().catch(() => {});
  }, { once: true });

  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });

  document.addEventListener('keydown', function(e) {
    if (
      e.key === 'F12' ||
      (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
      (e.ctrlKey && e.key === 'U')
    ) {
      e.preventDefault();
    }
  });
</script>

</body>
</html>
